model Convocation {
    id          Int      @id @default(autoincrement())
    studentId   String
    student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
    termId      String
    term        Term     @relation(fields: [termId], references: [id], onDelete: Cascade)
    date        DateTime
    reason      String
    createdAt   DateTime @default(now())
    createdById String
    comment     String?
}

model SubjectTimetable {
    id          Int            @id @default(autoincrement())
    weekday     Int // 0=Sun, 1=Mon ... 7=Sun
    start       String
    end         String
    subjectId   Int
    schoolId    String
    validFrom   DateTime       @default(now()) // when this rule started being true (inclusive)
    validTo     DateTime? // when it stopped (exclusive). null = still active
    category    TimetableGroup @default(SUBJECT)
    subject     Subject        @relation(fields: [subjectId], references: [id], onDelete: Cascade)
    createdById String?
    createdBy   User?          @relation("SubjectTimetableCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

    @@unique([start, end, subjectId])
    @@index([validFrom])
    @@index([validTo])
}

enum TimetableGroup {
    SUBJECT
}

enum AttendanceType {
    PERIODIC
    DAILY
}

model Attendance {
    id               Int            @id @default(autoincrement())
    type             AttendanceType
    data             Json
    studentId        String
    student          Student        @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    termId           String
    term             Term           @relation(fields: [termId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    createdAt        DateTime       @default(now())
    updatedAt        DateTime       @updatedAt
    createdById      String?
    createdBy        User?          @relation("attendanceCreatedBy", fields: [createdById], references: [id], onUpdate: Cascade)
    notificationSent Boolean        @default(false)
}
