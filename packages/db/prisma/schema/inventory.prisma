enum InventoryTrackingType {
    CONSUMABLE
    RETURNABLE
}

enum InventoryEventType {
    STOCK_IN
    CONSUME
    ASSIGN
    ADJUST
}

model InventoryUnit {
    id       String          @id @default(uuid())
    name     String
    schoolId String
    school   School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
    items    InventoryItem[]

    @@unique([schoolId, name])
}

model InventoryItem {
    id           String                @id @default(uuid())
    name         String
    trackingType InventoryTrackingType
    sku          String?
    serial       String?
    note         String?
    defaultReturnDate DateTime?
    minStockLevel Int?                 @default(0)
    unitId       String?
    unit         InventoryUnit?        @relation(fields: [unitId], references: [id], onDelete: SetNull)
    isActive     Boolean               @default(true)
    createdAt    DateTime              @default(now())
    updatedAt    DateTime              @updatedAt
    events       InventoryEvent[]
    schoolId     String
    school       School                @relation(fields: [schoolId], references: [id], onDelete: Cascade)

    @@index([schoolId, trackingType])
    @@index([schoolId, createdAt])
    @@unique([schoolId, serial])
}

model InventoryEvent {
    id           String             @id @default(uuid())
    itemId       String
    item         InventoryItem      @relation(fields: [itemId], references: [id], onDelete: Cascade)
    type         InventoryEventType
    quantity     Int                @default(1)
    assigneeId   String?
    assignee     User?              @relation("InventoryEventAssignee", fields: [assigneeId], references: [id])
    location     String?
    dueAt        DateTime?
    returnedAt   DateTime?
    returnedById String?
    returnedBy   User?              @relation("InventoryEventReturnedBy", fields: [returnedById], references: [id])
    note         String?
    createdAt    DateTime           @default(now())
    updatedAt    DateTime           @updatedAt
    createdById  String
    createdBy    User               @relation("InventoryEventCreatedBy", fields: [createdById], references: [id])
    schoolYearId String
    schoolYear   SchoolYear         @relation(fields: [schoolYearId], references: [id], onDelete: Cascade)
    schoolId     String
    school       School             @relation(fields: [schoolId], references: [id], onDelete: Cascade)

    @@index([schoolId, schoolYearId, createdAt])
    @@index([itemId, type, returnedAt])
    @@index([assigneeId, createdAt])
}
